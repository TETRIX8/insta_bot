# Архитектура Telegram бота для парсинга каналов и добавления комментариев

## Общая структура проекта

```
telegram_bot_project/
├── bot/                  # Код Telegram бота
│   ├── __init__.py
│   ├── bot.py            # Основной файл бота
│   ├── channel_monitor.py # Мониторинг каналов
│   ├── comment_manager.py # Управление комментариями
│   └── config.py         # Конфигурация бота
├── admin_panel/          # Код админ-панели
│   ├── __init__.py
│   ├── app.py            # Основной файл веб-приложения
│   ├── auth.py           # Аутентификация
│   ├── routes/           # Маршруты веб-приложения
│   │   ├── __init__.py
│   │   ├── channels.py   # Управление каналами
│   │   ├── comments.py   # Управление комментариями
│   │   └── settings.py   # Настройки
│   ├── static/           # Статические файлы (CSS, JS)
│   └── templates/        # HTML шаблоны
├── data/                 # Данные и база данных
│   ├── database.py       # Работа с базой данных
│   └── models.py         # Модели данных
└── main.py               # Точка входа в приложение
```

## Технологический стек

1. **Язык программирования**: Python 3.9+
2. **Telegram API библиотека**: Telethon (для работы с Telegram API, включая чтение сообщений и добавление комментариев)
3. **Веб-фреймворк для админ-панели**: Flask (легкий и гибкий фреймворк для создания веб-приложений)
4. **База данных**: SQLite (для простоты развертывания, с возможностью миграции на PostgreSQL при необходимости)
5. **ORM**: SQLAlchemy (для работы с базой данных)
6. **Фронтенд**: Bootstrap 5 (для создания красивого и отзывчивого интерфейса)
7. **Аутентификация**: Flask-Login (для управления сессиями пользователей)
8. **Планировщик задач**: APScheduler (для периодической очистки данных и мониторинга каналов)

## Компоненты системы

### 1. Telegram бот (bot/)

- **bot.py**: Основной класс бота, инициализация Telethon клиента
- **channel_monitor.py**: Компонент для мониторинга каналов и обнаружения новых постов
- **comment_manager.py**: Компонент для добавления комментариев к постам
- **config.py**: Конфигурация бота (API ID, API Hash, номер телефона)

### 2. Админ-панель (admin_panel/)

- **app.py**: Основной файл Flask приложения
- **auth.py**: Аутентификация пользователей (с начальным паролем 123456)
- **routes/**: Маршруты для различных функций админ-панели
  - **channels.py**: Управление подписками на каналы
  - **comments.py**: Управление комментариями для постов
  - **settings.py**: Настройки бота и смена пароля

### 3. Данные и база данных (data/)

- **database.py**: Инициализация и управление базой данных
- **models.py**: Модели данных:
  - `Channel`: Информация о каналах для мониторинга
  - `Post`: Информация о постах из каналов
  - `Comment`: Шаблоны комментариев для добавления
  - `PostComment`: Связь между постами и добавленными комментариями
  - `Setting`: Настройки бота и админ-панели

### 4. Точка входа (main.py)

- Инициализация всех компонентов
- Запуск бота и админ-панели
- Настройка планировщика задач для очистки данных

## Процессы и взаимодействие компонентов

### Мониторинг каналов и обнаружение новых постов

1. Бот подписывается на указанные в админ-панели каналы
2. Периодически проверяет наличие новых постов
3. При обнаружении нового поста сохраняет его в базу данных
4. Уведомляет админ-панель о новом посте

### Добавление комментариев

1. Администратор через админ-панель выбирает пост для комментирования
2. Вводит текст комментария
3. Система передает команду боту
4. Бот добавляет комментарий к посту в Telegram
5. Система сохраняет информацию о добавленном комментарии

### Автоочистка данных

1. Планировщик задач ежедневно проверяет возраст данных
2. Удаляет записи старше 3 дней
3. Обновляет статистику в админ-панели

## Безопасность

1. **Аутентификация**: Доступ к админ-панели защищен паролем
2. **Защита сессии**: Использование Flask-Login для управления сессиями
3. **Защита от CSRF**: Использование CSRF-токенов в формах
4. **Валидация ввода**: Проверка всех входных данных перед обработкой

## Масштабируемость и расширяемость

1. **Модульная архитектура**: Разделение на компоненты для легкого расширения
2. **Абстракция базы данных**: Использование ORM для возможности миграции на другие СУБД
3. **Конфигурируемость**: Вынесение настроек в отдельные файлы конфигурации
